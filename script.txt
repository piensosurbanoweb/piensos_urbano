-- Tabla clientes
CREATE TABLE clientes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    apodo VARCHAR(100) NOT NULL UNIQUE,
    nombre_completo VARCHAR(255) NOT NULL,
    telefono VARCHAR(20) NOT NULL,
    localidad VARCHAR(100) NOT NULL,
    zona_reparto VARCHAR(50) NOT NULL,
    observaciones TEXT
);

-- Tabla pedidos
CREATE TABLE pedidos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    cliente_id INT NOT NULL,
    apodo_cliente VARCHAR(100),
    tipo VARCHAR(50),
    dia_semana VARCHAR(20),
    cantidad DECIMAL(10,2),
    producto VARCHAR(255),
    fecha_entrega DATE,
    observaciones TEXT,
    fecha_creacion TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (cliente_id) REFERENCES clientes(id) ON DELETE CASCADE
);

-- Tabla pedidos_historial
CREATE TABLE pedidos_historial (
    id INT AUTO_INCREMENT PRIMARY KEY,
    cliente_id INT NOT NULL,
    descripcion TEXT NOT NULL,
    fecha_pedido DATE NOT NULL,
    fecha_entrega DATE NOT NULL,
    observaciones TEXT,
    FOREIGN KEY (cliente_id) REFERENCES clientes(id) ON DELETE CASCADE
);

-- Tabla pedidos_pendientes
CREATE TABLE pedidos_pendientes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    historial_id INT NOT NULL,
    cliente_id INT NOT NULL,
    apodo VARCHAR(100) NOT NULL,
    nombre_completo VARCHAR(255) NOT NULL,
    telefono VARCHAR(20) NOT NULL,
    localidad VARCHAR(100) NOT NULL,
    zona VARCHAR(50) NOT NULL,
    pedido TEXT NOT NULL,
    fecha_programacion DATE NOT NULL,
    observaciones TEXT,
    FOREIGN KEY (cliente_id) REFERENCES clientes(id) ON DELETE CASCADE,
    FOREIGN KEY (historial_id) REFERENCES pedidos_historial(id) ON DELETE CASCADE
);

-- Tabla pedidos_calendario
CREATE TABLE pedidos_calendario (
    id INT AUTO_INCREMENT PRIMARY KEY,
    historial_id INT NOT NULL,
    cliente_id INT,
    dia_reparto ENUM('lunes','martes','miercoles','jueves','viernes') NOT NULL,
    fecha_reparto DATE NOT NULL,
    orden_reparto INT DEFAULT 1,
    conductor VARCHAR(100) DEFAULT 'Sin asignar',
    camion VARCHAR(100) DEFAULT 'Sin asignar',
    observaciones TEXT,
    enviado_reparto BOOLEAN DEFAULT FALSE,
    fecha_envio_reparto DATE,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (cliente_id) REFERENCES clientes(id) ON DELETE SET NULL,
    FOREIGN KEY (historial_id) REFERENCES pedidos_historial(id) ON DELETE CASCADE
);

-- Tabla conductores
CREATE TABLE conductores (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL UNIQUE,
    activo BOOLEAN DEFAULT TRUE,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabla camiones
CREATE TABLE camiones (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL UNIQUE,
    activo BOOLEAN DEFAULT TRUE,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabla zonas
CREATE TABLE zonas (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL UNIQUE,
    activa BOOLEAN DEFAULT TRUE,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
